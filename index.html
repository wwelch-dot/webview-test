<html>

<head>
	<title>Geolocation test</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.min.css">
	<style>
		main {
			height: 100px;
		}
		#map {
			height: calc(100% - 100px);
		}
	</style>
</head>

<body>
	<main>
		<p>Geolocation test</p>
		<p id="results">
			Latitude: <span id="latitude"></span><br/>
			Longitude: <span id="longitude"></span><br/>
			Accuracy: <span id="accuracy"></span>
		</p>
	</main>
	<div id="map"></div>
	<script type="module"> 
		import leaflet from "https://cdn.jsdelivr.net/npm/leaflet@1.9.3/+esm";

		function locSuccess(position) {
			const fields = ['latitude','longitude','accuracy'];

			fields.forEach(field => {
				document.getElementById(field).innerHTML = position.coords[field];
			});

			var map = leaflet.map('map').setView([position.coords.latitude, position.coords.longitude], 19);

			L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);

			L.marker([position.coords.latitude, position.coords.longitude]).addTo(map)
				.bindPopup('Your location')
				.openPopup();
		}
		function locError(error) {
			console.error(error);
		}
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(locSuccess, locError, {enableHighAccuracy: true, maximumAge: 0, timeout: Infinity});
		}
	</script>
</body>

</html>